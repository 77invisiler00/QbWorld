<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FolderSocial Cloud Sync</title>
    <style>
        :root { --bg: #0b0e11; --sidebar: #2f3136; --accent: #5865f2; --card: #18191c; --msg: #36393f; }
        body { font-family: sans-serif; background: var(--bg); color: white; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .hidden { display: none !important; }
        
        /* Sidebar */
        .sidebar { width: 200px; background: var(--sidebar); display: flex; flex-direction: column; padding: 15px; border-right: 1px solid #333; flex-shrink: 0; }
        .nav-btn { padding: 12px; margin: 5px 0; border-radius: 8px; cursor: pointer; border: none; background: transparent; color: #b9bbbe; text-align: left; }
        .nav-btn.active { background: #4f545c; color: white; font-weight: bold; }

        /* Main Content */
        .main { flex: 1; display: flex; flex-direction: column; background: #36393f; position: relative; }
        .scroll { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; align-items: center; }

        /* Cards & Posts */
        .card { background: var(--card); width: 100%; max-width: 450px; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #444; }
        .post-img { width: 100%; border-radius: 8px; margin-top: 10px; }
        
        /* Chat & Comments */
        .comment { background: #202225; padding: 8px; border-radius: 6px; margin-top: 5px; font-size: 13px; }
        .chat-msg { background: var(--msg); padding: 10px; border-radius: 10px; margin-bottom: 8px; max-width: 80%; }

        input, textarea { width: 100%; padding: 10px; margin: 8px 0; border-radius: 6px; border: none; background: #202225; color: white; box-sizing: border-box; }
        button { background: var(--accent); color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h3>FolderCloud</h3>
        <button class="nav-btn active" onclick="showTab('feed', this)">üè† –°—Ç—Ä—ñ—á–∫–∞</button>
        <button class="nav-btn" onclick="showTab('chat', this)">üí¨ –ß–∞—Ç</button>
        <button onclick="logout()" style="margin-top:auto; background:#ed4245; color:white; border:none; padding:10px; border-radius:5px; cursor:pointer;">–í–∏—Ö—ñ–¥</button>
    </div>

    <div class="main">
        <div id="tab-feed" class="scroll">
            <div class="card">
                <input type="text" id="p-title" placeholder="–ù–∞–∑–≤–∞">
                <textarea id="p-desc" placeholder="–û–ø–∏—Å"></textarea>
                <input type="file" id="p-file" accept="image/*">
                <button onclick="publishPost()">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –≤—Å—é–¥–∏</button>
            </div>
            <div id="cloud-posts" style="width:100%"></div>
        </div>

        <div id="tab-chat" class="scroll hidden">
            <div id="chat-box" style="width:100%; max-width:600px; display:flex; flex-direction:column; padding-bottom:80px;"></div>
            <div style="position:absolute; bottom:0; width:100%; padding:15px; background:var(--sidebar); display:flex; gap:10px; box-sizing:border-box;">
                <input type="text" id="chat-input" placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." onkeydown="if(event.key==='Enter') sendChatMessage()">
                <button onclick="sendChatMessage()">üöÄ</button>
            </div>
        </div>
    </div>

<script>
    // –¢–í–û–Ñ –ü–û–°–ò–õ–ê–ù–ù–Ø (–∑—ñ —Å–∫—Ä—ñ–Ω—à–æ—Ç—É Firebase)
    const BASE_URL = "https://pointfilm-964c0-default-rtdb.firebaseio.com/";

    let user = JSON.parse(localStorage.getItem('user')) || { name: "User_" + Math.floor(Math.random()*999) };
    localStorage.setItem('user', JSON.stringify(user));

    function showTab(tab, btn) {
        document.getElementById('tab-feed').classList.add('hidden');
        document.getElementById('tab-chat').classList.add('hidden');
        document.getElementById('tab-' + tab).classList.remove('hidden');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    // --- –õ–û–ì–Ü–ö–ê –ü–û–°–¢–Ü–í –ó –§–û–¢–û –¢–ê –ö–û–ú–ï–ù–¢–ê–†–Ø–ú–ò ---
    async function publishPost() {
        const title = document.getElementById('p-title').value;
        const desc = document.getElementById('p-desc').value;
        const fileInput = document.getElementById('p-file');
        let imgData = "";

        if(fileInput.files[0]) {
            const reader = new FileReader();
            imgData = await new Promise(res => {
                reader.onload = e => res(e.target.result);
                reader.readAsDataURL(fileInput.files[0]);
            });
        }

        const post = { author: user.name, title, desc, img: imgData, likes: 0, comments: [] };
        await fetch(BASE_URL + "posts.json", { method: 'POST', body: JSON.stringify(post) });
        
        document.getElementById('p-title').value = "";
        document.getElementById('p-desc').value = "";
        document.getElementById('p-file').value = "";
        loadData();
    }

    async function addComment(postId, inputId) {
        const txt = document.getElementById(inputId).value;
        if(!txt) return;
        
        const comment = { user: user.name, txt: txt };
        await fetch(`${BASE_URL}posts/${postId}/comments.json`, { method: 'POST', body: JSON.stringify(comment) });
        document.getElementById(inputId).value = "";
        loadData();
    }

    // --- –õ–û–ì–Ü–ö–ê –ß–ê–¢–£ ---
    async function sendChatMessage() {
        const input = document.getElementById('chat-input');
        if(!input.value) return;
        const msg = { user: user.name, text: input.value, time: Date.now() };
        await fetch(BASE_URL + "chat.json", { method: 'POST', body: JSON.stringify(msg) });
        input.value = "";
        loadData();
    }

    // --- –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –í–°–¨–û–ì–û ---
    async function loadData() {
        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ—Å—Ç—ñ–≤
        const pRes = await fetch(BASE_URL + "posts.json");
        const pData = await pRes.json();
        const feed = document.getElementById('cloud-posts');
        feed.innerHTML = "";
        if(pData) {
            Object.keys(pData).reverse().forEach(id => {
                const p = pData[id];
                const coms = p.comments ? Object.values(p.comments).map(c => `<div class="comment"><b>${c.user}:</b> ${c.txt}</div>`).join('') : '';
                feed.innerHTML += `
                    <div class="card">
                        <small style="color:var(--accent)">@${p.author}</small>
                        <h3>${p.title}</h3>
                        <p>${p.desc}</p>
                        ${p.img ? `<img src="${p.img}" class="post-img">` : ''}
                        <div style="margin-top:10px;">${coms}</div>
                        <div style="display:flex; gap:5px; margin-top:10px;">
                            <input type="text" id="in-${id}" placeholder="–ö–æ–º–µ–Ω—Ç—É–≤–∞—Ç–∏..." style="margin:0; font-size:12px;">
                            <button onclick="addComment('${id}', 'in-${id}')" style="padding:5px;">üí¨</button>
                        </div>
                    </div>`;
            });
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–∞—Ç—É
        const cRes = await fetch(BASE_URL + "chat.json");
        const cData = await cRes.json();
        const chatBox = document.getElementById('chat-box');
        chatBox.innerHTML = "";
        if(cData) {
            Object.values(cData).forEach(m => {
                chatBox.innerHTML += `<div class="chat-msg" style="${m.user === user.name ? 'align-self:flex-end; background:var(--accent)' : ''}">
                    <b style="font-size:10px; opacity:0.8;">${m.user}</b><br>${m.text}
                </div>`;
            });
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    }

    function logout() { localStorage.clear(); location.reload(); }
    
    // –ê–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 3 —Å–µ–∫—É–Ω–¥–∏ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
    setInterval(loadData, 3000);
    loadData();
</script>
</body>
</html>
