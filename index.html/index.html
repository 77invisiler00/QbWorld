<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>FolderSocial Cloud</title>
    <style>
        :root { --bg: #0b0e11; --sidebar: #2f3136; --accent: #5865f2; --card: #18191c; }
        body { font-family: sans-serif; background: var(--bg); color: white; margin: 0; display: flex; height: 100vh; }
        .sidebar { width: 200px; background: var(--sidebar); padding: 20px; border-right: 1px solid #333; }
        .main { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .card { background: var(--card); width: 100%; max-width: 500px; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #333; }
        input, textarea { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: none; background: #202225; color: white; box-sizing: border-box; }
        button { background: var(--accent); color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold; }
        .status { font-size: 12px; color: #3ba55d; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2>FolderCloud</h2>
    <div id="user-info">Завантаження...</div>
    <button onclick="localStorage.clear(); location.reload();" style="margin-top:20px; background:#ed4245">Вихід</button>
</div>

<div class="main">
    <div class="status" id="db-status">● Підключено до хмари</div>
    
    <div class="card">
        <h3>Новий пост</h3>
        <input type="text" id="p-title" placeholder="Назва">
        <textarea id="p-desc" placeholder="Опис"></textarea>
        <button onclick="publishToCloud()">Опублікувати всюди</button>
    </div>

    <div id="cloud-feed" style="width:100%; display:flex; flex-direction:column; align-items:center;"></div>
</div>

<script>
    // Твоє посилання з Firebase (зі скріншоту)
    const DB_URL = "https://pointfilm-964c0-default-rtdb.firebaseio.com/posts.json";
    
    let user = JSON.parse(localStorage.getItem('user')) || { name: "Гість_" + Math.floor(Math.random()*1000) };
    localStorage.setItem('user', JSON.stringify(user));
    document.getElementById('user-info').innerText = "Ви: " + user.name;

    // 1. ФУНКЦІЯ ПУБЛІКАЦІЇ В ХМАРУ
    async function publishToCloud() {
        const title = document.getElementById('p-title').value;
        const desc = document.getElementById('p-desc').value;
        
        if(!title) return alert("Заповни назву");

        const newPost = {
            author: user.name,
            title: title,
            desc: desc,
            time: new Date().getTime()
        };

        // Відправляємо дані на сервер Firebase
        await fetch(DB_URL, {
            method: 'POST',
            body: JSON.stringify(newPost)
        });

        document.getElementById('p-title').value = "";
        document.getElementById('p-desc').value = "";
        loadFromCloud(); // Оновити стрічку
    }

    // 2. ФУНКЦІЯ ЗАВАНТАЖЕННЯ З ХМАРИ (працює на всіх пристроях)
    async function loadFromCloud() {
        const response = await fetch(DB_URL);
        const data = await response.json();
        
        const feed = document.getElementById('cloud-feed');
        feed.innerHTML = "";

        if (data) {
            // Перетворюємо об'єкт Firebase у масив і сортуємо (нові зверху)
            const posts = Object.keys(data).map(id => data[id]).reverse();
            
            posts.forEach(p => {
                feed.innerHTML += `
                    <div class="card">
                        <small style="color:#5865f2">@${p.author}</small>
                        <h2 style="margin:5px 0">${p.title}</h2>
                        <p>${p.desc}</p>
                    </div>
                `;
            });
        }
    }

    // Оновлювати кожні 5 секунд, щоб бачити пости з інших пристроїв
    setInterval(loadFromCloud, 5000);
    loadFromCloud();
</script>

</body>
</html>
